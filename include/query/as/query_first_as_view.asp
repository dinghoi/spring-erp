<%

query_first_as_view = ""
query_first_as_view = query_first_as_view + " SELECT A.SIDO                                                                                                                                                           " 
query_first_as_view = query_first_as_view + "      , CNT_1                                                                                                                                                            "
query_first_as_view = query_first_as_view + "      , CNT_2                                                                                                                                                            "
query_first_as_view = query_first_as_view + "      , CNT_3                                                                                                                                                            "
query_first_as_view = query_first_as_view + "      , CNT_4                                                                                                                                                            "
query_first_as_view = query_first_as_view + "      , CNT_5                                                                                                                                                            "
query_first_as_view = query_first_as_view + "      , CNT_6                                                                                                                                                            "
query_first_as_view = query_first_as_view + "      , CNT_7                                                                                                                                                            "
query_first_as_view = query_first_as_view + "      , CNT_8                                                                                                                                                            "
query_first_as_view = query_first_as_view + "      , CNT_9                                                                                                                                                            "
query_first_as_view = query_first_as_view + "      , CNT_10                                                                                                                                                           "
query_first_as_view = query_first_as_view + "      , CNT_11                                                                                                                                                           "
query_first_as_view = query_first_as_view + "      , CNT_12                                                                                                                                                           "
query_first_as_view = query_first_as_view + "      , FORMAT(CNT_11 /CNT_13 * 100,2)  AS CNT_13                                                                                                                        "
query_first_as_view = query_first_as_view + " FROM (                                                                                                                                                                  "
query_first_as_view = query_first_as_view + "                                                                                                                                                                         "
query_first_as_view = query_first_as_view + "   select                                                                                                                                                                "
query_first_as_view = query_first_as_view + "        IFNULL(A.SIDO,'계') AS SIDO                                                                                                                                      "
query_first_as_view = query_first_as_view + "       , SUM(IF(A.REAL_DATE_DIFF <= 0 , ERR_CNT ,0))   AS 'CNT_1'                                                                                                        "
query_first_as_view = query_first_as_view + "       , SUM(IF(A.REAL_DATE_DIFF <= 0 AND A.AS_PROCESS ='입고'   , ERR_CNT ,0)) AS 'CNT_2'                                                                               "
query_first_as_view = query_first_as_view + "       , SUM(IF(A.REAL_DATE_DIFF = 1    , ERR_CNT ,0)) AS 'CNT_3'                                                                                                        "
query_first_as_view = query_first_as_view + "       , SUM(IF(A.REAL_DATE_DIFF = 1  AND A.AS_PROCESS ='입고'  , ERR_CNT ,0)) AS 'CNT_4'                                                                                "
query_first_as_view = query_first_as_view + "       , SUM(IF(A.REAL_DATE_DIFF = 2      , ERR_CNT ,0)) AS 'CNT_5'                                                                                                      "
query_first_as_view = query_first_as_view + "       , SUM(IF(A.REAL_DATE_DIFF = 2   AND A.AS_PROCESS ='입고'   , ERR_CNT ,0)) AS 'CNT_6'                                                                              "
query_first_as_view = query_first_as_view + "                                                                                                                                                                         "
query_first_as_view = query_first_as_view + "       , SUM(IF(A.REAL_DATE_DIFF >= 3 AND   A.REAL_DATE_DIFF <=6   , ERR_CNT  ,0)) AS 'CNT_7'                                                                            "
query_first_as_view = query_first_as_view + "       , SUM(IF(A.REAL_DATE_DIFF >= 3 AND   A.REAL_DATE_DIFF <=6  AND A.AS_PROCESS ='입고' , ERR_CNT  ,0)) AS 'CNT_8'                                                    "
query_first_as_view = query_first_as_view + "                                                                                                                                                                         "
query_first_as_view = query_first_as_view + "       , SUM(IF(A.REAL_DATE_DIFF >=7    , ERR_CNT ,0)) AS 'CNT_9'                                                                                                        "
query_first_as_view = query_first_as_view + "       , SUM(IF(A.REAL_DATE_DIFF >=7   AND A.AS_PROCESS ='입고'   , ERR_CNT ,0)) AS 'CNT_10'                                                                             "
query_first_as_view = query_first_as_view + "                                                                                                                                                                         "
query_first_as_view = query_first_as_view + "       , SUM(ERR_CNT) AS 'CNT_11'                                                                                                                                        "
query_first_as_view = query_first_as_view + "       , SUM(IF(A.AS_PROCESS ='입고', ERR_CNT,0)) AS 'CNT_12'                                                                                                            "
query_first_as_view = query_first_as_view + "       , (SELECT    COUNT(*) AS ERR_CNT                                                                                                                                  "
query_first_as_view = query_first_as_view + "               FROM   AS_ACPT A                                                                                                                                          "
query_first_as_view = query_first_as_view + "              WHERE   1=1                                                                                                                                                "
query_first_as_view = query_first_as_view + "              AND   A.AS_PROCESS IN( '접수' ,'입고' , '연기')                                                                                                            "
query_first_as_view = query_first_as_view + "              AND   as_type ='방문처리'                                                                                                                                  "
query_first_as_view = query_first_as_view + "              AND   mg_group ='1' ) AS 'CNT_13'                                                                                                                          "
query_first_as_view = query_first_as_view + "   FROM                                                                                                                                                                  "
query_first_as_view = query_first_as_view + "   (                                                                                                                                                                     "
query_first_as_view = query_first_as_view + "     SELECT case A.SIDO WHEN '서울' then '본사'                                                                                                                          "
query_first_as_view = query_first_as_view + "                        WHEN '경기' then '본사'                                                                                                                          "
query_first_as_view = query_first_as_view + "                        WHEN '부산' then '부산지사'                                                                                                                      "
query_first_as_view = query_first_as_view + "                        WHEN '대구' then '대구지사'                                                                                                                      "
query_first_as_view = query_first_as_view + "                        WHEN '인천' then '본사'                                                                                                                          "
query_first_as_view = query_first_as_view + "                        WHEN '광주' then '광주지사'                                                                                                                      "
query_first_as_view = query_first_as_view + "                                                                                                                                                                         "
query_first_as_view = query_first_as_view + "                        WHEN '대전' then '대전지사'                                                                                                                      "
query_first_as_view = query_first_as_view + "                        WHEN '울산' then '부산지사'                                                                                                                      "
query_first_as_view = query_first_as_view + "                        WHEN '강원' then '강원지사'                                                                                                                      "
query_first_as_view = query_first_as_view + "                        WHEN '경남' then '부산지사'                                                                                                                      "
query_first_as_view = query_first_as_view + "                        WHEN '경북' then '대구지사'                                                                                                                      "
query_first_as_view = query_first_as_view + "                        WHEN '충남' then '대전지사'                                                                                                                      "
query_first_as_view = query_first_as_view + "                        WHEN '충북' then '대전지사'                                                                                                                      "
query_first_as_view = query_first_as_view + "                        WHEN '세종' then '대전지사'                                                                                                                      "
query_first_as_view = query_first_as_view + "                        WHEN '전남' then '광주지사'                                                                                                                      "
query_first_as_view = query_first_as_view + "                        WHEN '전북' then '전주지사'                                                                                                                      "
query_first_as_view = query_first_as_view + "                        WHEN '제주' then '제주지사'                                                                                                                      "
query_first_as_view = query_first_as_view + "                        ELSE 17 END SIDO                                                                                                                                 "
query_first_as_view = query_first_as_view + "            ,A.AS_PROCESS                                                                                                                                                "
query_first_as_view = query_first_as_view + "            ,A.ACPT_DATE , A.COM_DATE ,A.VISIT_DAY                                                                                                                       "
query_first_as_view = query_first_as_view + "            ,A.VISIT_HH                                                                                                                                                  "
query_first_as_view = query_first_as_view + "            ,A.ERR_CNT                                                                                                                                                   "
query_first_as_view = query_first_as_view + "             ,IF (DATEDIFF(VISIT_DATE,COM_DATE) <=0 ,0                                                                                                                  "
query_first_as_view = query_first_as_view + "                , IF ( A.VISIT_DAY  = A.ACPT_DATE ,0 , DATEDIFF(VISIT_DAY,ACPT_DATE)  -                                                                                  "
query_first_as_view = query_first_as_view + "                 (                                                                                                                                                       "
query_first_as_view = query_first_as_view + "                  SELECT                                                                                                                                                 "
query_first_as_view = query_first_as_view + "                        Floor (DATEDIFF(VISIT_DAY,ACPT_DATE) / 7) * 2                                                                                                    "
query_first_as_view = query_first_as_view + "                       + IF(DAYOFWEEK(ACPT_DATE)=1 or DAYOFWEEK(ACPT_DATE)=7,1,0)                                                                                        "
query_first_as_view = query_first_as_view + "                       + IF(DAYOFWEEK(VISIT_DAY)=1 or DAYOFWEEK(VISIT_DAY)=7,1,0)                                                                                        "
query_first_as_view = query_first_as_view + "                ) - (SELECT count(*)                                                                                                                                     "
query_first_as_view = query_first_as_view + "                        from holiday                                                                                                                                     "
query_first_as_view = query_first_as_view + "                       WHERE   1=1                                                                                                                                       "
query_first_as_view = query_first_as_view + "                         AND  holiday BETWEEN ACPT_DATE AND  VISIT_DAY )                                                                                                 "
query_first_as_view = query_first_as_view + "                                                                                                                                                                         "
query_first_as_view = query_first_as_view + "                )                                                                                                                                                        "
query_first_as_view = query_first_as_view + "                )  AS REAL_DATE_DIFF                                                                                                                                     "
query_first_as_view = query_first_as_view + "     FROM                                                                                                                                                                "
query_first_as_view = query_first_as_view + "     (                                                                                                                                                                   "
query_first_as_view = query_first_as_view + "             SELECT   A.SIDO, A.AS_PROCESS                                                                                                                               "
query_first_as_view = query_first_as_view + "                    , CAST(ACPT_DATE AS DATE) AS ACPT_DATE                                                                                                               "
query_first_as_view = query_first_as_view + "                    , CAST((A.ACPT_DATE + INTERVAL 10 DAY_HOUR) AS DATE) AS COM_DATE                                                                                     "
query_first_as_view = query_first_as_view + "                    , NOW() AS VISIT_DAY                                                                                                                                 "
query_first_as_view = query_first_as_view + "                    , ADDDATE(NOW(),INTERVAL 12 DAY_HOUR) AS VISIT_DATE                                                                                                  "
query_first_as_view = query_first_as_view + "                    , SUBSTRING(VISIT_TIME,1,2) AS VISIT_HH                                                                                                              "
query_first_as_view = query_first_as_view + "                    , COUNT(*) AS ERR_CNT                                                                                                                                "
query_first_as_view = query_first_as_view + "               FROM   AS_ACPT A                                                                                                                                          "
query_first_as_view = query_first_as_view + "              WHERE   1=1                                                                                                                                                "
query_first_as_view = query_first_as_view + "              AND   A.AS_PROCESS IN( '접수' ,'입고' , '연기')                                                                                                            "
query_first_as_view = query_first_as_view + "              AND   AS_TYPE ='방문처리'                                                                                                                                  "
query_first_as_view = query_first_as_view + "              AND   MG_GROUP ='1'                                                                                                                                        "
query_first_as_view = query_first_as_view + "             GROUP BY   A.SIDO, A.AS_PROCESS, Cast(acpt_date as date),CAST((A.ACPT_DATE + INTERVAL 10 DAY_HOUR) AS DATE)                                                 "
query_first_as_view = query_first_as_view + "     ) A                                                                                                                                                                 "
query_first_as_view = query_first_as_view + "   Order By A.sido Asc                                                                                                                                                   "
query_first_as_view = query_first_as_view + "   ) A                                                                                                                                                                   "
query_first_as_view = query_first_as_view + "                                                                                                                                                                         "
query_first_as_view = query_first_as_view + "   group by A.SIDO WITH ROLLUP                                                                                                                                           "
query_first_as_view = query_first_as_view + " ) A                                                                                                                                                                     "
query_first_as_view = query_first_as_view + " order by case A.SIDO WHEN '본사' then 0                                                                                                                                 "
query_first_as_view = query_first_as_view + "                      WHEN '부산지사' then 1                                                                                                                             "
query_first_as_view = query_first_as_view + "                      WHEN '대구지사' then 2                                                                                                                             "
query_first_as_view = query_first_as_view + "                      WHEN '대전지사' then 3                                                                                                                             "
query_first_as_view = query_first_as_view + "                      WHEN '광주지사' then 4                                                                                                                             "
query_first_as_view = query_first_as_view + "                      WHEN '전주지사' then 5                                                                                                                             "
query_first_as_view = query_first_as_view + "                      WHEN '강원지사' then 6                                                                                                                             "
query_first_as_view = query_first_as_view + "                      WHEN '제주지사' then 7                                                                                                                             "
query_first_as_view = query_first_as_view + "                      ELSE -1 END                                                                                                                                        "



%>
